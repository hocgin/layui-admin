<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../libs/layui/css/layui.css">
    <link rel="stylesheet" href="../core/main.css">
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin ext-layout-admin">
    <div class="layui-header">
        <div class="layui-logo">layui 后台布局</div>
        <!-- 头部区域（可配合layui已有的水平导航） -->
        <ul class="layui-nav layui-layout-left">
            <li class="layui-nav-item">
                <a href="javascript:;" layadmin-event="flexible" title="侧边伸缩">
                    <i class="layui-icon layui-icon-shrink-right" id="LAY_app_flexible"></i>
                </a>
            </li>
            <li class="layui-nav-item layui-hide-xs" lay-unselect>
                <a href="http://www.layui.com/admin/" target="_blank" title="前台">
                    <i class="layui-icon layui-icon-website"></i>
                </a>
            </li>
            <li class="layui-nav-item" lay-unselect>
                <a href="javascript:;" layadmin-event="refresh" title="刷新">
                    <i class="layui-icon layui-icon-refresh"></i>
                </a>
            </li>
            <li class="layui-nav-item"><a href="">控制台</a></li>
            <li class="layui-nav-item"><a href="">商品管理</a></li>
            <li class="layui-nav-item"><a href="">用户</a></li>
            <li class="layui-nav-item">
                <a href="javascript:;">其它系统</a>
                <dl class="layui-nav-child">
                    <dd><a href="">邮件管理</a></dd>
                    <dd><a href="">消息管理</a></dd>
                    <dd><a href="">授权管理</a></dd>
                </dl>
            </li>
        </ul>
        <ul class="layui-nav layui-layout-right" lay-filter="layout-nav-right">
            <li class="layui-nav-item" lay-unselect="">
                <a lay-href="app/message/" layadmin-event="message">
                    <i class="layui-icon layui-icon-notice"></i>
                    <!-- 如果有新消息，则显示小圆点 -->
                    <span class="layui-badge-dot"></span>
                    <span class="layui-badge-dot"></span>
                </a>
            </li>
            <li class="layui-nav-item layui-hide-xs" lay-unselect="">
                <a href="javascript:;" layadmin-event="theme">
                    <i class="layui-icon layui-icon-theme"></i>
                </a>
            </li>
            <li class="layui-nav-item layui-hide-xs" lay-unselect="" style="">
                <a href="javascript:;" layadmin-event="note">
                    <i class="layui-icon layui-icon-note"></i>
                </a>
            </li>
            <li class="layui-nav-item">
                <a href="javascript:;">
                    <img src="http://t.cn/RCzsdCq" class="layui-nav-img">
                    贤心
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="">基本资料</a></dd>
                    <dd><a href="">安全设置</a></dd>
                </dl>
            </li>
            <li class="layui-nav-item layui-hide-xs" lay-unselect lay-event="about">
                <a href="javascript:;">
                    <i class="layui-icon layui-icon-more-vertical"></i>
                </a>
            </li>
        </ul>
    </div>

    <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            <ul class="layui-nav layui-nav-tree" lay-filter="test">
                <li class="layui-nav-item layui-nav-itemed">
                    <a class="" href="javascript:;">所有商品</a>
                    <dl class="layui-nav-child">
                        <dd><a href="javascript:;">列表一</a></dd>
                        <dd><a href="javascript:;">列表二</a></dd>
                        <dd><a href="javascript:;">列表三</a></dd>
                        <dd><a href="">超链接</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">解决方案</a>
                    <dl class="layui-nav-child">
                        <dd><a href="javascript:;">列表一</a></dd>
                        <dd><a href="javascript:;">列表二</a></dd>
                        <dd><a href="">超链接</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="">云市场</a>
                </li>
                <li class="layui-nav-item">
                    <a href="/layui-admin/pages/demo.html" data-menu>Demo</a>
                </li>
                <li class="layui-nav-item">
                    <a href="/layui-admin/pages/demo/baidu.html" data-menu>Baidu</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="ext-page-tabs">
        <div class="layui-icon ext-tabs-control ext-tabs-control-prev"></div>
        <div class="layui-icon ext-tabs-control ext-tabs-control-next"></div>
        <div class="layui-icon ext-tabs-control ext-tabs-control-down">
            <ul class="layui-nav layout-tabs-select" lay-filter="tabs-option">
                <li class="layui-nav-item" lay-unselect>
                    <a href="javascript:;">
                        <span class="layui-nav-more"></span>
                    </a>
                    <dl class="layui-nav-child layui-anim-fadein layui-anim layui-anim-upbit">
                        <dd lay-event="closeThisTab"><a href="javascript:;;">关闭当前标签</a></dd>
                        <dd lay-event="closeOtherTab"><a href="javascript:;;">关闭其他标签</a></dd>
                        <dd lay-event="closeAllTab"><a href="javascript:;;">关闭所有标签</a></dd>
                    </dl>
                </li>
            </ul>
        </div>
        <div class="layui-tab layui-tab-brief" lay-filter="layout-tab-pages" lay-unauto lay-allowClose="true">
            <ul class="layui-tab-title"></ul>
        </div>
    </div>
    <div class="layui-body">
        <div class="layui-tab-content" lay-filter="layout-tab-pages"></div>
    </div>
    <div class="layui-footer">
        <!-- 底部固定区域 -->
        © layui.com - 底部固定区域
    </div>
</div>

<script src="../libs/layui/layui.js"></script>
<script>
    layui.use(['layer', 'element', 'jquery', 'laytpl'], (args) => {
        let layer = layui.layer,
            element = layui.element,
            laytpl = layui.laytpl,
            $ = layui.jquery
        ;
        element.render('nav', 'tabs-option');


        let LayoutTabPages = function () {

        };
        ltp = new LayoutTabPages();
        /**
         *
         * {
         *      href: ''
         *      id: ''
         *      title: ''
         *      allowClose: false
         * }
         * */
        LayoutTabPages.prototype.tabAdd = function (filter, options) {
            let TITLE = '.layui-tab-title',
                $tabElem = $('.layui-tab[lay-filter=' + filter + ']'),
                $titElem = $tabElem.children(TITLE),
                $contElem = $('.layui-tab-content[lay-filter=' + filter + ']'),
                li = '<li lay-id="' + (options.id || '') + '" allow-close="' + (!!options.allowClose) + '">' + (options.title || 'unnaming') + '</li>',
                CLOSE = 'layui-tab-close'
            ;

            $.get(options.href, (html) => {
                // tab
                let $li = $(li);
                $titElem.append($li);
                if (options.allowClose === 'true'
                    && !$li.find('.' + CLOSE)[0]) {
                    let $close = $('<i class="layui-icon layui-unselect ' + CLOSE + '">&#x1006;</i>');
                    $close.on('click', call.tabDelete);
                    $li.append($close);
                }

                // content
                $contElem.children('.layui-tab-item').removeClass('layui-show');
                $contElem.append('<div class="layui-tab-item layui-show" lay-id="' + (options.id || '') + '">' + (html || '') + '</div>');
                element.tabChange(filter, options.href);

                // 调整
                call.tabAuto.call($tabElem);
            });

            return this;
        };
        LayoutTabPages.prototype.preTabPage = function (filter) {
            let TITLE = '.layui-tab-title',
                $tabElem = $('.layui-tab[lay-filter=' + filter + ']')
            ;
            call.preTabPage.call($tabElem);

        };
        LayoutTabPages.prototype.nextTabPage = function (filter) {
            let TITLE = '.layui-tab-title',
                $tabElem = $('.layui-tab[lay-filter=' + filter + ']')
            ;
            call.nextTabPage.call($tabElem);

        };
        LayoutTabPages.prototype.closeOtherTab = function (filter) {
            let TITLE = '.layui-tab-title',
                $tabElem = $('.layui-tab[lay-filter=' + filter + ']')
            ;
            call.closeOtherTab.call($tabElem);
        };
        LayoutTabPages.prototype.closeThisTab = function (filter) {
            let TITLE = '.layui-tab-title',
                $tabElem = $('.layui-tab[lay-filter=' + filter + ']')
            ;
            call.closeThisTab.call($tabElem);
        };
        LayoutTabPages.prototype.closeAllTab = function (filter) {
            let TITLE = '.layui-tab-title',
                $tabElem = $('.layui-tab[lay-filter=' + filter + ']')
            ;
            call.closeAllTab.call($tabElem);
        };
        let call = {
            tabDelete(e, $that) {
                let $li = $that || $(this).parent(),
                    THIS = 'layui-this',
                    index = $li.index()
                    , $parents = $li.parents('.layui-tab').eq(0)
                    , ALLOW_CLOSE = 'allow-close'
                    , item = $('.layui-tab-content').children('.layui-tab-item').eq(index)
                ;
                if ($li.attr(ALLOW_CLOSE) === 'false') { // =false
                    return;
                }
                if ($li.hasClass(THIS)) {
                    if ($li.next()[0]) {
                        call.tabClick.call($li.next()[0], null, index + 1);
                    } else if ($li.prev()[0]) {
                        call.tabClick.call($li.prev()[0], null, index - 1);
                    }
                }

                $li.remove();
                item.remove();
                call.tabAuto($parents)
            },
            tabClick(e, index, liElem) {
                let that = liElem || $(this), // tab
                    THIS = 'layui-this',
                    SHOW = 'layui-show',
                    item = $('.layui-tab-content').children('.layui-tab-item')
                ;
                that.addClass(THIS).siblings().removeClass(THIS);
                item.eq(index).addClass(SHOW).siblings().removeClass(SHOW);
            },
            tabAuto($that) {
                let $this = $that || $(this), // tabElem
                    $title = $this.children('.layui-tab-title'),
                    $tabs = $title.children('li')
                ;
                if (!!$tabs.length) {
                    let $lastTab = $tabs.eq($tabs.length - 1);
                    if ($lastTab.offset().left + 1 < $this.offset().left) {
                        $title.css('left', -$lastTab.position().left);
                    } else if (($lastTab.offset().left + $lastTab.outerWidth()) + 1 > ($this.offset().left + $this.outerWidth())) {
                        $title.css('left', $title.outerWidth() - $title.prop('scrollWidth'));
                    }
                }
            },
            preTabPage($that) {
                let $this = $that || $(this), // tabElem
                    $title = $this.children('.layui-tab-title'),
                    $tabs = $title.children('li')
                ;
                let left = Math.abs($title.position().left) - $this.outerWidth();
                $tabs.each((i, tab) => {
                    let $tab = $(tab);
                    if ($tab.position().left > left) {
                        $title.css('left', -$tab.position().left);
                        return false;
                    }
                });
            },
            nextTabPage($that) {
                let $this = $that || $(this), // tabElem
                    $title = $this.children('.layui-tab-title'),
                    $tabs = $title.children('li')
                ;
                let left = Math.abs($title.position().left) + $this.outerWidth();
                left = left < 0 ? 0 : left;
                $tabs.each((i, tab) => {
                    let $tab = $(tab);
                    if ($tab.position().left > left) {
                        $title.css('left', -$tab.position().left);
                        return false;
                    }
                });
            },
            closeOtherTab($that) {
                let $this = $that || $(this), // tabElem
                    $title = $this.children('.layui-tab-title'),
                    $tabs = $title.children('li'),
                    THIS = 'layui-this'
                ;
                let $otherTabs = $tabs.not('.' + THIS);
                $otherTabs.each((i, tab) => {
                    let $tab = $(tab);
                    call.tabDelete(null, $tab);
                });
            },
            closeThisTab($that) {
                let $this = $that || $(this), // tabElem
                    $title = $this.children('.layui-tab-title'),
                    $tabs = $title.children('li'),
                    THIS = 'layui-this'
                ;
                let $thisTab = $tabs.filter('.' + THIS);
                call.tabDelete(null, $thisTab);
            },
            closeAllTab($that) {
                let $this = $that || $(this), // tabElem
                    $title = $this.children('.layui-tab-title'),
                    $tabs = $title.children('li')
                ;
                $tabs.each((i, tab) => {
                    let $tab = $(tab);
                    call.tabDelete(null, $tab);
                });
                call.tabClick.call($tabs.eq(0), null, 0);
            }
        };
        /**
         * Tab
         */
        let FILTER_LAYOUT_TAB_PAGES = 'layout-tab-pages';
        $('a[data-menu]').on('click', (e) => {
            let $this = $(e.target);
            let href = $this.attr('href');
            e.preventDefault();
            if (!href || $('.ext-page-tabs li').is('[lay-id="' + href + '"]')) {
                return false;
            }
            ltp.tabAdd(FILTER_LAYOUT_TAB_PAGES, {
                href: href,
                id: href,
                title: $this.text(),
                allowClose: true
            });
            return false;
        });

        ltp.tabAdd(FILTER_LAYOUT_TAB_PAGES, {
            href: '/layui-admin/pages/demo.html',
            id: '/layui-admin/pages/demo.html',
            title: '<i class="layui-icon layui-icon-home"></i>',
            allowClose: false
        });
        for (let i = 0; i < 100; i++) {
            ltp.tabAdd(FILTER_LAYOUT_TAB_PAGES, {
                href: '/layui-admin/pages/demo.html',
                id: '/layui-admin/pages/demo.html',
                title: "::" + i++,
                allowClose: true
            });
        }

        $('.ext-tabs-control-prev').on('click', (e) => {
            ltp.preTabPage(FILTER_LAYOUT_TAB_PAGES);
        });
        $('.ext-tabs-control-next').on('click', (e) => {
            ltp.nextTabPage(FILTER_LAYOUT_TAB_PAGES);
        });

        // Tab 事件
        element.tab({
            headerElem: '.layui-tab[lay-filter="' + FILTER_LAYOUT_TAB_PAGES + '"]>.layui-tab-title>li',
            bodyElem: '.layui-tab-content[lay-filter="' + FILTER_LAYOUT_TAB_PAGES + '"]>.layui-tab-item'
        });

        element.on('nav(tabs-option)', (elem) => {
            let $this = $(elem),
                event = $this.attr('lay-event');
            if (event === 'closeThisTab') {
                ltp.closeThisTab(FILTER_LAYOUT_TAB_PAGES);
            }else if (event === 'closeAllTab') {
                ltp.closeAllTab(FILTER_LAYOUT_TAB_PAGES);
            }else if (event === 'closeOtherTab') {
                ltp.closeOtherTab(FILTER_LAYOUT_TAB_PAGES);
            }
        });

        element.on('tab(layout-tab-pages)', (data) => {
            // let $tab = $(data.elem).eq(data.index);
            // element.tabChange(FILTER_LAYOUT_TAB_PAGES, $tab.attr('lay-id'));
            // let elem = data.elem;
            // console.log("data", data);
            // console.log("box", data.elem);
            // console.log("index", data.index);
        });

        /**
         * about
         */
        element.on('nav(layout-nav-right)', (elem) => {
            let $this = $(elem);
            let event = $this.attr('lay-event');
            if (event === 'about') {
                layer.open({
                    title: '版本信息',
                    area: ['300px'],
                    offset: 'r',
                    type: 1,
                    skin: 'layui-anim layui-anim-rl layui-layer-adminRight', //样式类名
                    closeBtn: 0, //不显示关闭按钮
                    anim: -1,
                    shadeClose: true, //开启遮罩关闭
                    content: '内容'
                });
            }
        });

    });
</script>
</body>
</html>